<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.ylif4.cf","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="YLiF4">
<meta property="og:url" content="https://www.ylif4.cf/index.html">
<meta property="og:site_name" content="YLiF4">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="LewisLi">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.ylif4.cf/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>YLiF4</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">YLiF4</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">0</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">0</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">10</span></a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">LewisLi</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.ylif4.cf/%E8%BE%9B%E6%99%AE%E6%A3%AE%E7%A7%AF%E5%88%86%E6%B3%95">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LewisLi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YLiF4">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BE%9B%E6%99%AE%E6%A3%AE%E7%A7%AF%E5%88%86%E6%B3%95" class="post-title-link" itemprop="url">辛普森积分法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-26 21:51:54 / 修改时间：21:57:13" itemprop="dateCreated datePublished" datetime="2021-07-26T21:51:54+08:00">2021-07-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="定积分"><a href="#定积分" class="headerlink" title="定积分"></a>定积分</h1><p>函数 $f(x)$ 在区间 $[l,r]$ 上的定积分 $\int_{l}^{r} f(x) dx$ 指的是 $f(x)$ 在区间 $[l,r]$ 内与 $x$ 轴所围成的区域的面积（$x$轴上方为正，下方为负）。</p>
<p>我们需要一种高效的求解这种积分的近似值的方法，于是就有了<strong>辛普森积分法</strong>。</p>
<h1 id="普通辛普森法"><a href="#普通辛普森法" class="headerlink" title="普通辛普森法"></a>普通辛普森法</h1><p>辛普森法的基本思想是将求解区间分成若干段，每一段都使用二次函数的积分公式来进行求解。</p>
<p>二次函数积分公式（辛普森公式）：</p>
<p>对于一个二次函数$f(x)=Ax^2+Bx+C$，有<br>$$<br>\int_l^r f(x) {\mathrm d}x = \frac{(r-l)(f(l)+f(r)+4 f(\frac{l+r}{2}))}{6}<br>$$<br>证（from OI-Wiki）：</p>
<p>求积分可得<br>$$<br>F(x)=\int_0^x f(x) {\mathrm d}x = \frac{a}{3}x^3+\frac{b}{2}x^2+cx+D<br>$$<br>那么则有<br>$$<br>\begin{aligned} \int_l^r f(x) {\mathrm d}x &amp;= F(r)-F(l) \ &amp;= \frac{a}{3}(r^3-l^3)+\frac{b}{2}(r^2-l^2)+c(r-l) \ &amp;=(r-l)(\frac{a}{3}(l^2+r^2+lr)+\frac{b}{2}(l+r)+c) \ &amp;=\frac{r-l}{6}(2al^2+2ar^2+2alr+3bl+3br+6c)\ &amp;=\frac{r-l}{6}((al^2+bl+c)+(ar^2+br+c)+4(a(\frac{l+r}{2})^2+b(\frac{l+r}{2})+c)) \ &amp;=\frac{r-l}{6}(f(l)+f(r)+4f(\frac{l+r}{2})) \end{aligned}<br>$$<br>然后我们通过套公式就可以写出这样一段代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">simpson</span><span class="params">(<span class="keyword">double</span> l, <span class="keyword">double</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> (r - l) * (<span class="built_in">f</span>(l) + <span class="number">4</span> * <span class="built_in">f</span>(mid) + <span class="built_in">f</span>(r)) / <span class="number">6</span>; <span class="comment">//f(x)为待求解的函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="自适应辛普森"><a href="#自适应辛普森" class="headerlink" title="自适应辛普森"></a>自适应辛普森</h1><p>普通的辛普森积分法为了保证精度，在时间效率上会很大地受到区间的限制。</p>
<p>问题在于：区间少了精度不够，区间多了又太慢。</p>
<p>自适应辛普森做到了<strong>自动控制拆分区间的大小</strong>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">asr</span><span class="params">(<span class="keyword">double</span> l, <span class="keyword">double</span> r, <span class="keyword">double</span> eps, <span class="keyword">double</span> ans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> fl = <span class="built_in">simpson</span>(l, mid), fr = <span class="built_in">simpson</span>(mid, r);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(fl + fr - ans) &lt;= <span class="number">15</span> * eps)</span><br><span class="line">        <span class="keyword">return</span> fl + fr + (fl + fr - ans) / <span class="number">15</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">asr</span>(l, mid, eps / <span class="number">2</span>, fl) + <span class="built_in">asr</span>(mid, r, eps / <span class="number">2</span>, fr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到了这里，你就可以去做 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4525"><strong>Luogu P4525 【模板】自适应辛普森法1</strong></a>了！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.ylif4.cf/%E6%B5%85%E8%B0%88%E5%8D%9A%E5%BC%88%E8%AE%BA%E4%B8%8E-sg-%E5%87%BD%E6%95%B0">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LewisLi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YLiF4">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%B5%85%E8%B0%88%E5%8D%9A%E5%BC%88%E8%AE%BA%E4%B8%8E-sg-%E5%87%BD%E6%95%B0" class="post-title-link" itemprop="url">浅谈博弈论与 SG 函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-26 21:51:54 / 修改时间：21:57:37" itemprop="dateCreated datePublished" datetime="2021-07-26T21:51:54+08:00">2021-07-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><blockquote>
<p><strong>我不是人类，我没有智慧。</strong></p>
</blockquote>
<p>一个<strong>有限无偏游戏</strong>（即<strong>公平组合游戏</strong>，以下简称<strong>游戏</strong>）有两名玩家，他们按照某种规则轮流进行操作。在游戏的一个局面下，双方允许进行的操作完全相同，且只取决于<strong>当前局面</strong>。当无法进行操作时游戏结束，不能行动的玩家输。游戏由一个初始局面开始，且一定会结束。</p>
<p>我们定义一个游戏的当前局面 $A$，它的后继局面就是通过一次操作，能够到达的局面。记作 $A’$，并且记 $A=A’$。</p>
<p>记 $0$ 为无法操作的游戏。显然它为一个后手游戏。</p>
<ul>
<li>加法：对于两个游戏 $A,B$，定义游戏 $C=A+B={A’+B,A+B’}$。通俗来讲，就是玩家只能在其中的一个游戏里进行操作。</li>
<li>相等：$\forall F,F+A $的局面与 $F+B$ 相同。</li>
<li>$\forall G,G+0=G$。</li>
<li>$\forall G,G+G=0$</li>
<li>两个游戏 $A,B$ 相同当且仅当 $A+B=0$。</li>
</ul>
<h1 id="Nim-游戏"><a href="#Nim-游戏" class="headerlink" title="Nim 游戏"></a>Nim 游戏</h1><p>咕了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.ylif4.cf/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LewisLi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YLiF4">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0" class="post-title-link" itemprop="url">后缀自动机学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-26 21:51:54 / 修改时间：21:57:49" itemprop="dateCreated datePublished" datetime="2021-07-26T21:51:54+08:00">2021-07-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="定义与性质"><a href="#定义与性质" class="headerlink" title="定义与性质"></a>定义与性质</h1><p>后缀自动机（Suffix Automaton，简称 SAM）是用于解决字符串问题的强有力的工具。它是一个能够接受字符串所有后缀的最小 DFA。</p>
<p>SAM 是一张有向无环图，每个节点叫做<strong>状态</strong>，每条边被称作<strong>转移</strong>。</p>
<p>SAM 存在一个源点 $t$，称为<strong>初始状态</strong>。任何状态均可从初始状态到达。</p>
<p>每一个转移都对应于一个字母，每个状态的转移都各不相同。</p>
<p>存在若干个<strong>终止状态</strong>。从 $t$ 出发走到一个终止状态，则这条路径对应原串的一个后缀。同样的，任意一个后缀都可以通过 SAM 上从初始状态到终止状态的一条路径来表示。</p>
<p>SAM 上每一条路径对应原串的一个子串。换句话说， SAM 上的路径和原串上的子串一一对应。</p>
<p>到达某个状态的路径不止一条，所以一个状态表示的实际上是一个集合。</p>
<h1 id="构造-SAM"><a href="#构造-SAM" class="headerlink" title="构造 SAM"></a>构造 SAM</h1><p>在构造 SAM 之前，我们需要了解一些前置知识。</p>
<h2 id="结束位置集合-endpos"><a href="#结束位置集合-endpos" class="headerlink" title="结束位置集合 endpos"></a>结束位置集合 endpos</h2><p>对于串 $s$ 的任意一个非空的子串 $t$，我们定义 $\operatorname{endpos}(t)$ 为字符串 $t$ 在 $s$ 中出现的末尾位置的集合。</p>
<p>例如，有 $s=”abcaabcabca”$，$t=”abc”$ 的 $\operatorname{endpos}(t)={3, 7,10}$（下标从 $1$ 开始）。</p>
<p>两个非空子串 $t_1,t_2$ 的 $\operatorname{endpos}$ 可能相等，我们称这两个 $\operatorname{endpos}$ 是<strong>等价的</strong>，它们同属于同一个<strong>等价类</strong>。原串 $s$ 的所有子串被这样划分为若干个<strong>等价类</strong>。</p>
<blockquote>
<p>引理1：同属于同一个等价类的串之间必然有后缀关系。如果两个字符串 $t_1,t_2\ (|t_1| \leqslant |t_2|)$ 的 $\operatorname{endpos}$ 相同，当且仅当 $t_1$ 在 $s$ 中每次出现，都是 $t_2$ 的后缀。</p>
</blockquote>
<p>由定义，引理显然成立。</p>
<blockquote>
<p>引理2：考虑两个 $s$ 的子串 $u,v \ (|u| \leqslant |v|)$，有<br>$$<br>\begin{cases}<br>\operatorname{endpos}(v) \subseteq \operatorname{endpos}(u) &amp; \text{if}\ u\ \text{is a suffix of}\ v\<br>\operatorname{endpos}(u) \cap \operatorname{endpos}(v) = \varnothing &amp; \text{otherwise}<br>\end{cases}<br>$$</p>
</blockquote>
<p>如果 $u$ 是 $v$ 的后缀，那么每一次 $v$ 出现 $u$ 都会出现，所以 $\operatorname{endpos}(v) \subseteq \operatorname{endpos}(u)$。否则，两者绝对不会有相同的 $\operatorname{endpos}$。</p>
<blockquote>
<p>引理3：每一个 $\operatorname{endpos}$ 类都是由若干个长度连续，并且具有后缀关系的子串构成的。</p>
</blockquote>
<p>上面引理的推论</p>
<blockquote>
<p>引理4：同一个 $\operatorname{endpos}$ 类中的子串同时加上同一个字符后，它们仍然属于同一个 $\operatorname{endpos}$ 类。</p>
</blockquote>
<p>同时加上一个字符，仍然满足后缀关系。</p>
<h2 id="后缀链接和-parent-树"><a href="#后缀链接和-parent-树" class="headerlink" title="后缀链接和 parent 树"></a>后缀链接和 parent 树</h2><p>对于一个不是初始状态的状态 $v$，我们将其中的串按照长度从大到小排序，由引理3，除去最大的以外，其余每个子串都是最大串的后缀。记这个最大串为 $\operatorname{longest}(v)$，其长度为 $\text{len}(v)$。</p>
<p>我们找到第一个 $\operatorname{longest}(v)$ 的后缀 $t$ 使得  $v\subsetneqq\operatorname{endpos}(t)=u$。我们就将 $\operatorname{fail}(v) \rightarrow u$。</p>
<blockquote>
<p>引理5：所有后缀链接构成了一棵树。</p>
</blockquote>
<p>每个状态的出度和入度都为 $1$。我们称这棵树为 parent 树。</p>
<blockquote>
<p>引理6：由后缀链接构成的 parent 树与后缀树相同。</p>
</blockquote>
<p>不知道。</p>
<h2 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h2><p>我们定义在插入某个字符 $c$ 前的状态为 $last$，新插入的状态为  $now$。</p>
<p>我们沿着 $last$ 的 $fail$ 边向上跳，设每次跳到状态 $p$。如果 $p$ 没有连向 $c$ 的边，那么就讲它直接连向 $now$。</p>
<p>如果最后跳到了 $t$ 就将 $\text{fail}(now) \rightarrow t$。</p>
<p>否则分成两种情况：</p>
<p>我们定义状态 $q$ 为 $p$ 转移为 $c$ 的状态。</p>
<ol>
<li><p>$\text{len}(p) = \text{len}(p) + 1$</p>
<p>说明 $q$ 和 $p$ 之间只差了一个字符。此时可以直接 $\text{fail}(now) \rightarrow q$。</p>
</li>
<li><p>否则，我们需要新建一个节点来辅助建边。</p>
<p>我们新建状态 $clone = q$，复制其除了 $len$ 的所有信息。</p>
<p>让 $\text{len}(clone)=\text{len}(p)+1$。</p>
<p>此时我们让 $\text{fail}(q) \rightarrow clone, \text{fail}(now) \rightarrow clone$。</p>
</li>
</ol>
<h2 id="正确性证明"><a href="#正确性证明" class="headerlink" title="正确性证明"></a>正确性证明</h2><p>不会。</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Suffix_Automaton</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> len, fail;</span><br><span class="line">        <span class="keyword">int</span> ch[<span class="number">26</span>];</span><br><span class="line">    &#125; tr[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, last = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p = last, q, now = ++tot;</span><br><span class="line">        siz[now] = <span class="number">1</span>;</span><br><span class="line">        tr[now].len = tr[p].len + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; p &amp;&amp; !tr[p].ch[x]; p = tr[p].fail)</span><br><span class="line">            tr[p].ch[x] = now;</span><br><span class="line">        <span class="keyword">if</span> (!p) &#123;</span><br><span class="line">            tr[now].fail = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            q = tr[p].ch[x];</span><br><span class="line">            <span class="keyword">if</span> (tr[q].len == tr[p].len + <span class="number">1</span>) &#123;</span><br><span class="line">                tr[now].fail = q;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> cl = ++tot;</span><br><span class="line">                tr[cl] = tr[q];</span><br><span class="line">                tr[cl].len = tr[p].len + <span class="number">1</span>;</span><br><span class="line">                tr[q].fail = tr[now].fail = cl;</span><br><span class="line">                <span class="keyword">for</span> (; p &amp;&amp; tr[p].ch[x] == q; p = tr[p].fail)</span><br><span class="line">                    tr[p].ch[x] = cl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        last = now;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; SAM;</span><br></pre></td></tr></table></figure>

<h1 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h1><p>咕咕咕</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.ylif4.cf/%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LewisLi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YLiF4">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" class="post-title-link" itemprop="url">可持久化数据结构</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-26 21:51:54 / 修改时间：21:58:48" itemprop="dateCreated datePublished" datetime="2021-07-26T21:51:54+08:00">2021-07-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="可持久化简介"><a href="#可持久化简介" class="headerlink" title="可持久化简介"></a>可持久化简介</h1><p>可持久化数据结构保留了每一次修改的历史版本。</p>
<ul>
<li>部分可持久化：可以访问所有历史版本，但只能修改最新版本。</li>
<li>完全可持久化：所有历史版本都可以访问和修改。</li>
</ul>
<p>我们有一个暴力的想法，就是每次修改都将整体复制一份。这样的空间复杂度是$\operatorname{O}(NM)$的。</p>
<p>可持久化为我们提供了一个思路：每一次只复制变化的部分，保留不变的部分，空间复杂度为$\operatorname{O}(N+M)$。</p>
<h1 id="可持久化线段树"><a href="#可持久化线段树" class="headerlink" title="可持久化线段树"></a>可持久化线段树</h1><p>我们每一次修改都只会使树上$\log_2N$个节点发生变化。</p>
<p>我们动态开点地存每一个节点，在向下递归的过程中，每遇到一个需要修改的节点，就复制一份向下更新。</p>
<p>最后所有节点构成了一张图[<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/250565583">1</a>]：</p>
<p><img src="https://pic2.zhimg.com/v2-e41c74ec213257cec4f3c3429e9d037d_r.jpg"></p>
<h2 id="Luogu-P3919-【模板】可持久化线段树-1（可持久化数组）"><a href="#Luogu-P3919-【模板】可持久化线段树-1（可持久化数组）" class="headerlink" title="Luogu P3919 【模板】可持久化线段树 1（可持久化数组）"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3919">Luogu P3919 【模板】可持久化线段树 1（可持久化数组）</a></h2><p>单点修改，单点查询的操作，可以使用可持久化线段树实现。</p>
<p>实际上有不带$\log$的做法，但是实现麻烦。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> ls, rs;</span><br><span class="line">    <span class="keyword">int</span> sum;</span><br><span class="line">&#125; t[N &lt;&lt; <span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> rt[N];</span><br><span class="line"><span class="keyword">int</span> tot;</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123; t[k].sum = t[t[k].ls].sum + t[t[k].rs].sum; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = ++tot;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        t[p].sum = a[l];</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    t[p].ls = <span class="built_in">build</span>(l, mid), t[p].rs = <span class="built_in">build</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">pushup</span>(p);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> loc, <span class="keyword">int</span> delta)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = ++tot;</span><br><span class="line">    t[p] = t[k];</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        t[p].sum = delta;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (loc &lt;= mid)</span><br><span class="line">        t[p].ls = <span class="built_in">update</span>(t[p].ls, l, mid, loc, delta);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        t[p].rs = <span class="built_in">update</span>(t[p].rs, mid + <span class="number">1</span>, r, loc, delta);</span><br><span class="line">    <span class="built_in">pushup</span>(p);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> t[k].sum;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (pos &lt;= mid) <span class="keyword">return</span> <span class="built_in">query</span>(t[k].ls, l, mid, pos);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">query</span>(t[k].rs, mid+<span class="number">1</span>, r, pos);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d &quot;</span>, a + i);</span><br><span class="line">    rt[<span class="number">0</span>] = <span class="built_in">build</span>(<span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>, v, op, loc, value; i&lt;=m; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;v, &amp;op, &amp;loc);</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;value);</span><br><span class="line">            rt[i] = <span class="built_in">update</span>(rt[v], <span class="number">1</span>, n, loc, value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">query</span>(rt[v], <span class="number">1</span>, n, loc));</span><br><span class="line">            rt[i] = rt[v];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Luogu-P3834-【模板】可持久化线段树-2（主席树）"><a href="#Luogu-P3834-【模板】可持久化线段树-2（主席树）" class="headerlink" title="Luogu P3834 【模板】可持久化线段树 2（主席树）"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3834">Luogu P3834 【模板】可持久化线段树 2（主席树）</a></h2><p>我们一般称可持久化线段树为主席树。但实际上，可持久化权值线段树才是主席树。</p>
<p>来源其实是黄嘉泰发明的用于求静态区间第$k$小的算法。</p>
<ul>
<li><p>首先构建一棵值全为0的可持久化线段树。</p>
</li>
<li><p>之后对原数组进行离散化。</p>
</li>
<li><p>然后我们按照原来$1 \to n$的顺序将<strong>离散化后</strong>的值，以1号版本为基准，插入到可持久化线段树内。</p>
</li>
<li><p>现在我们就可以查询区间$[1,R]$的第$k$小了。对于$[L,R]$的第$k$小，我们只需去除$[1,L-1]$即可。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> ls, rs;</span><br><span class="line">    <span class="keyword">int</span> sum;</span><br><span class="line">&#125; t[N &lt;&lt; <span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> rt[N];</span><br><span class="line"><span class="keyword">int</span> tot;</span><br><span class="line"><span class="keyword">int</span> a[N], b[N], len;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">discreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(b, a, <span class="built_in"><span class="keyword">sizeof</span></span>(a));</span><br><span class="line">    <span class="built_in">sort</span>(b + <span class="number">1</span>, b + <span class="number">1</span> + n);</span><br><span class="line">    len = <span class="built_in">unique</span>(b + <span class="number">1</span>, b + <span class="number">1</span> + n) - b - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">lower_bound</span>(b + <span class="number">1</span>, b + <span class="number">1</span> + len, val) - b; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = ++tot;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    t[p].ls = <span class="built_in">build</span>(l, mid), t[p].rs = <span class="built_in">build</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> delta)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = ++tot;</span><br><span class="line">    t[p] = t[k], t[p].sum = t[k].sum + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (delta &lt;= mid)</span><br><span class="line">        t[p].ls = <span class="built_in">insert</span>(t[p].ls, l, mid, delta);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        t[p].rs = <span class="built_in">insert</span>(t[p].rs, mid + <span class="number">1</span>, r, delta);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>, delta = t[t[y].ls].sum - t[t[x].ls].sum;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    <span class="keyword">if</span> (k &lt;= delta)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(t[x].ls, t[y].ls, l, mid, k);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(t[x].rs, t[y].rs, mid + <span class="number">1</span>, r, k - delta);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d &quot;</span>, a + i);</span><br><span class="line">    <span class="built_in">discreate</span>();</span><br><span class="line">    rt[<span class="number">0</span>] = <span class="built_in">build</span>(<span class="number">1</span>, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        rt[i] = <span class="built_in">insert</span>(rt[i - <span class="number">1</span>], <span class="number">1</span>, len, <span class="built_in">find</span>(a[i]));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> l, r, rk; m; m--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;l, &amp;r, &amp;rk);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, b[<span class="built_in">query</span>(rt[l - <span class="number">1</span>], rt[r], <span class="number">1</span>, len, rk)]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="LOJ2402-THUPC-2017-天天爱射击-shooting"><a href="#LOJ2402-THUPC-2017-天天爱射击-shooting" class="headerlink" title="LOJ2402 [THUPC 2017] 天天爱射击 / shooting"></a><a target="_blank" rel="noopener" href="https://loj.ac/p/2402">LOJ2402 [THUPC 2017] 天天爱射击 / shooting</a></h2><p>如果我们从子弹的角度看，我们需要知道有哪些木板还存在，并且还要将打破的木板删除。这样的暴力复杂度是难以接受的，也是极难实现的。我们考虑从木板的角度看：因为子弹按顺序打出，不会消失，所以一块木板能否被打碎只取决于包含在它这个区间内的子弹数量是否足以打破它。这就转换成了一个区间求和问题。</p>
<p>那我们怎么知道被哪颗子弹打碎呢？很显然就是第$s$颗打到它上面的子弹。</p>
<p>那就变成了一个静态区间第$k$小的问题，可以用主席树解决。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">4e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, Ans[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> x1, x2;</span><br><span class="line">    <span class="keyword">int</span> s;</span><br><span class="line">&#125; Q[N];</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; pos[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> ls, rs;</span><br><span class="line">    <span class="keyword">int</span> sum;</span><br><span class="line">&#125; t[N&lt;&lt;<span class="number">5</span>];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls(k) t[k].ls</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs(k) t[k].rs</span></span><br><span class="line"><span class="keyword">int</span> cnt, rt[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123; t[k].sum = t[<span class="built_in">ls</span>(k)].sum + t[<span class="built_in">rs</span>(k)].sum; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = ++cnt;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> p;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">ls</span>(p) = <span class="built_in">build</span>(l, mid), <span class="built_in">rs</span>(p) = <span class="built_in">build</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = ++cnt;</span><br><span class="line">    t[p] = t[k];</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        t[p].sum++;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (x &lt;= mid) <span class="built_in">ls</span>(p) = <span class="built_in">update</span>(<span class="built_in">ls</span>(k), l, mid, x);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">rs</span>(p) = <span class="built_in">update</span>(<span class="built_in">rs</span>(k), mid+<span class="number">1</span>, r, x);</span><br><span class="line">    <span class="built_in">pushup</span>(p);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!x || !y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>, delta = t[<span class="built_in">ls</span>(y)].sum - t[<span class="built_in">ls</span>(x)].sum;</span><br><span class="line">    <span class="keyword">if</span> (t[y].sum - t[x].sum &lt; k) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> l;</span><br><span class="line">    <span class="keyword">if</span> (k &lt;= delta) <span class="keyword">return</span> <span class="built_in">query</span>(<span class="built_in">ls</span>(x), <span class="built_in">ls</span>(y), l, mid, k);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">query</span>(<span class="built_in">rs</span>(x), <span class="built_in">rs</span>(y), mid+<span class="number">1</span>, r, k-delta);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mx;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;Q[i].x1, &amp;Q[i].x2, &amp;Q[i].s), mx = <span class="built_in">max</span>(mx, Q[i].x2);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=m; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]), pos[a[i]].<span class="built_in">push_back</span>(i), mx = <span class="built_in">max</span>(mx, a[i]);</span><br><span class="line">    rt[<span class="number">0</span>] = <span class="built_in">build</span>(<span class="number">1</span>, mx);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=mx; i++) &#123;</span><br><span class="line">        rt[i] = rt[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> j : pos[i]) &#123;</span><br><span class="line">            rt[i] = <span class="built_in">update</span>(rt[i], <span class="number">1</span>, m, j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="built_in">query</span>(rt[Q[i].x1<span class="number">-1</span>], rt[Q[i].x2], <span class="number">1</span>, m, Q[i].s);</span><br><span class="line">        Ans[x]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=m; i++) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, Ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CF916D-Jamie-and-To-do-List"><a href="#CF916D-Jamie-and-To-do-List" class="headerlink" title="CF916D Jamie and To-do List"></a><a target="_blank" rel="noopener" href="http://codeforces.com/problemset/problem/916/D">CF916D Jamie and To-do List</a></h2><h3 id="题目大意"><a href="#题目大意" class="headerlink" title="题目大意"></a>题目大意</h3><p>您需要维护一个数据结构，支持以下操作：</p>
<ul>
<li><code>set s x</code>  将字符串 $s$ 的权值设为 $x$ ，如果没有则加入 $s$ 。</li>
<li><code>remove s</code>  删除 $s$ 。</li>
<li><code>query s </code>  查询有多少个字符串的权值小于 $s$ 。如果 $s$ 不存在则输出 <code>-1</code>。</li>
<li><code>undo x</code> 撤销之前的 $x$ 次操作。</li>
</ul>
<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>一看到撤销就知道要可持久化。</p>
<p>首先用<code>map</code>将字符串映射为整数。</p>
<p>在没有<code>undo</code>操作的情况下，用数组维护权值，权值线段树进行查询即可。</p>
<p>加入<code>undo</code>后就将上面两个东西可持久化就可以了。</p>
<p>tips：不要混用<code>cin</code>和<code>puts</code>，会<code>ILE</code>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>, INF = <span class="number">1e9</span>;</span><br><span class="line"><span class="keyword">int</span> n, id;</span><br><span class="line">map&lt;string, <span class="keyword">int</span>&gt; mp;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getid</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mp.<span class="built_in">count</span>(s)) <span class="keyword">return</span> mp[s];</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> mp[s] = ++id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> ls, rs;</span><br><span class="line">    <span class="keyword">int</span> sum;</span><br><span class="line">&#125; t[N&lt;&lt;<span class="number">7</span>];</span><br><span class="line"><span class="keyword">int</span> rt1[N&lt;&lt;<span class="number">1</span>], rt2[N&lt;&lt;<span class="number">1</span>], tot;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls(k) t[k].ls</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs(k) t[k].rs</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123; t[k].sum = t[<span class="built_in">ls</span>(k)].sum + t[<span class="built_in">rs</span>(k)].sum; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = ++tot, mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    t[p] = t[k];</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        t[p].sum += v;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x &lt;= mid) <span class="built_in">ls</span>(p) = <span class="built_in">update</span>(<span class="built_in">ls</span>(k), l, mid, x, v);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">rs</span>(p) = <span class="built_in">update</span>(<span class="built_in">rs</span>(k), mid+<span class="number">1</span>, r, x, v);</span><br><span class="line">    <span class="built_in">pushup</span>(p);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= ql &amp;&amp; r &lt;= qr) <span class="keyword">return</span> t[k].sum;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>, res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= mid) res += <span class="built_in">query</span>(<span class="built_in">ls</span>(k), l, mid, ql, qr);</span><br><span class="line">    <span class="keyword">if</span> (qr &gt; mid) res += <span class="built_in">query</span>(<span class="built_in">rs</span>(k), mid+<span class="number">1</span>, r, ql, qr);</span><br><span class="line">    <span class="comment">// printf(&quot;rres=%d\n&quot;, res);</span></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">string s, op;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>), cout.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>, num, x; i&lt;=n; i++) &#123;</span><br><span class="line">        cin&gt;&gt;op;</span><br><span class="line">        rt1[i] = rt1[i<span class="number">-1</span>], rt2[i] = rt2[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;s&#x27;</span>) &#123;</span><br><span class="line">            cin&gt;&gt;s&gt;&gt;num;</span><br><span class="line">            x = <span class="built_in">getid</span>(s);</span><br><span class="line">            <span class="keyword">int</span> res = <span class="built_in">query</span>(rt1[i], <span class="number">1</span>, INF, x, x);</span><br><span class="line">            <span class="keyword">if</span> (res) rt2[i] = <span class="built_in">update</span>(rt2[i], <span class="number">1</span>, INF, res, <span class="number">-1</span>);</span><br><span class="line">            rt2[i] = <span class="built_in">update</span>(rt2[i], <span class="number">1</span>, INF, num, <span class="number">1</span>);</span><br><span class="line">            rt1[i] = <span class="built_in">update</span>(rt1[i], <span class="number">1</span>, INF, x, num-res);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;r&#x27;</span>) &#123;</span><br><span class="line">            cin&gt;&gt;s;</span><br><span class="line">            x = <span class="built_in">getid</span>(s);</span><br><span class="line">            <span class="keyword">int</span> res = <span class="built_in">query</span>(rt1[i], <span class="number">1</span>, INF, x, x);</span><br><span class="line">            rt1[i] = <span class="built_in">update</span>(rt1[i], <span class="number">1</span>, INF, x, -res);</span><br><span class="line">            <span class="keyword">if</span> (res) rt2[i] = <span class="built_in">update</span>(rt2[i], <span class="number">1</span>, INF, res, <span class="number">-1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;q&#x27;</span>) &#123;</span><br><span class="line">            cin&gt;&gt;s;</span><br><span class="line">            x = <span class="built_in">getid</span>(s);</span><br><span class="line">            <span class="keyword">int</span> res = <span class="built_in">query</span>(rt1[i], <span class="number">1</span>, INF, x, x);</span><br><span class="line">            <span class="keyword">if</span> (res == <span class="number">0</span>) cout&lt;&lt;<span class="string">&quot;-1&quot;</span>&lt;&lt;endl;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (res == <span class="number">1</span>) cout&lt;&lt;<span class="string">&quot;0&quot;</span>&lt;&lt;endl;</span><br><span class="line">            <span class="keyword">else</span> cout&lt;&lt;<span class="built_in">query</span>(rt2[i], <span class="number">1</span>, INF, <span class="number">1</span>, res<span class="number">-1</span>)&lt;&lt;endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            cin&gt;&gt;num;</span><br><span class="line">            rt1[i] = rt1[i-num<span class="number">-1</span>], rt2[i] = rt2[i-num<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        cout&lt;&lt;flush;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="可持久化平衡树"><a href="#可持久化平衡树" class="headerlink" title="可持久化平衡树"></a>可持久化平衡树</h1><p>应用的并不多，权当一个了解。利用可持久化的思路可以快速打出来，这里不再赘述。</p>
<p>常说的可持久化平衡树一般指的就是可持久化 Treap。</p>
<h2 id="Luogu-P3835-【模板】可持久化平衡树"><a href="#Luogu-P3835-【模板】可持久化平衡树" class="headerlink" title="Luogu P3835 【模板】可持久化平衡树"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3835">Luogu P3835 【模板】可持久化平衡树</a></h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e5</span> + <span class="number">5</span>, INF = <span class="number">2147483647</span>;</span><br><span class="line"><span class="keyword">int</span> n, rt[N];</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FHQ_Treap</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> ls, rs;</span><br><span class="line">        <span class="keyword">int</span> rd, val, siz;</span><br><span class="line">    &#125; t[N * <span class="number">50</span>];</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls(kk) t[kk].ls</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs(kk) t[kk].rs</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123; t[k].siz = t[<span class="built_in">ls</span>(k)].siz + t[<span class="built_in">rs</span>(k)].siz + <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> k = ++cnt;</span><br><span class="line">        t[k].siz = <span class="number">1</span>;</span><br><span class="line">        t[k].val = v;</span><br><span class="line">        t[k].rd = <span class="built_in">rand</span>();</span><br><span class="line">        <span class="built_in">ls</span>(k) = <span class="built_in">rs</span>(k) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> k;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">(<span class="keyword">int</span> now, <span class="keyword">int</span> k, <span class="keyword">int</span> &amp;x, <span class="keyword">int</span> &amp;y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!now) &#123;</span><br><span class="line">            x = y = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (t[now].val &lt;= k) &#123;</span><br><span class="line">            x = ++cnt;</span><br><span class="line">            t[x] = t[now];</span><br><span class="line">            <span class="built_in">split</span>(<span class="built_in">rs</span>(x), k, <span class="built_in">rs</span>(x), y);</span><br><span class="line">            <span class="built_in">pushup</span>(x);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            y = ++cnt;</span><br><span class="line">            t[y] = t[now];</span><br><span class="line">            <span class="built_in">split</span>(<span class="built_in">ls</span>(y), k, x, <span class="built_in">ls</span>(y));</span><br><span class="line">            <span class="built_in">pushup</span>(y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x || !y)</span><br><span class="line">            <span class="keyword">return</span> x | y;</span><br><span class="line">        <span class="keyword">int</span> p = ++cnt;</span><br><span class="line">        <span class="keyword">if</span> (t[x].rd &lt; t[y].rd) &#123;</span><br><span class="line">            t[p] = t[x];</span><br><span class="line">            <span class="built_in">rs</span>(p) = <span class="built_in">merge</span>(<span class="built_in">rs</span>(p), y);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            t[p] = t[y];</span><br><span class="line">            <span class="built_in">ls</span>(p) = <span class="built_in">merge</span>(x, <span class="built_in">ls</span>(p));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">pushup</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">(<span class="keyword">int</span> &amp;root, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x, y;</span><br><span class="line">        <span class="built_in">split</span>(root, v, x, y);</span><br><span class="line">        root = <span class="built_in">merge</span>(<span class="built_in">merge</span>(x, <span class="built_in">newnode</span>(v)), y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">del</span><span class="params">(<span class="keyword">int</span> &amp;root, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a, b, c, d;</span><br><span class="line">        <span class="built_in">split</span>(root, v, a, b), <span class="built_in">split</span>(a, v - <span class="number">1</span>, c, d);</span><br><span class="line">        root = <span class="built_in">merge</span>(<span class="built_in">merge</span>(c, <span class="built_in">merge</span>(<span class="built_in">ls</span>(d), <span class="built_in">rs</span>(d))), b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(<span class="keyword">int</span> now, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k == t[<span class="built_in">ls</span>(now)].siz + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> t[now].val;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (k &lt;= t[<span class="built_in">ls</span>(now)].siz)</span><br><span class="line">                now = <span class="built_in">ls</span>(now);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                k -= t[<span class="built_in">ls</span>(now)].siz + <span class="number">1</span>, now = <span class="built_in">rs</span>(now);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">rk</span><span class="params">(<span class="keyword">int</span> &amp;root, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x, y;</span><br><span class="line">        <span class="built_in">split</span>(root, val - <span class="number">1</span>, x, y);</span><br><span class="line">        <span class="keyword">int</span> res = t[x].siz + <span class="number">1</span>;</span><br><span class="line">        root = <span class="built_in">merge</span>(x, y);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">pre</span><span class="params">(<span class="keyword">int</span> &amp;root, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x, y, res;</span><br><span class="line">        <span class="built_in">split</span>(root, val - <span class="number">1</span>, x, y);</span><br><span class="line">        <span class="keyword">if</span> (!t[x].siz)</span><br><span class="line">            res = -INF;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            res = <span class="built_in">kth</span>(x, t[x].siz);</span><br><span class="line">        root = <span class="built_in">merge</span>(x, y);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">nxt</span><span class="params">(<span class="keyword">int</span> &amp;root, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x, y, res;</span><br><span class="line">        <span class="built_in">split</span>(root, val, x, y);</span><br><span class="line">        <span class="keyword">if</span> (!t[y].siz)</span><br><span class="line">            res = INF;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            res = <span class="built_in">kth</span>(y, <span class="number">1</span>);</span><br><span class="line">        root = <span class="built_in">merge</span>(x, y);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; fhq;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="keyword">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, op, v, x; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;v, &amp;op, &amp;x);</span><br><span class="line">        rt[i] = rt[v];</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">1</span>)</span><br><span class="line">            fhq.<span class="built_in">ins</span>(rt[i], x);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="number">2</span>)</span><br><span class="line">            fhq.<span class="built_in">del</span>(rt[i], x);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="number">3</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, fhq.<span class="built_in">rk</span>(rt[i], x));</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="number">4</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, fhq.<span class="built_in">kth</span>(rt[i], x));</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="number">5</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, fhq.<span class="built_in">pre</span>(rt[i], x));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, fhq.<span class="built_in">nxt</span>(rt[i], x));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="可持久化-Trie"><a href="#可持久化-Trie" class="headerlink" title="可持久化 Trie"></a>可持久化 Trie</h1><p>每一次新插入字符串就新建一个根。</p>
<h2 id="Luogu-P4735-最大异或和"><a href="#Luogu-P4735-最大异或和" class="headerlink" title="Luogu P4735 最大异或和"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4735">Luogu P4735 最大异或和</a></h2><p>咕咕咕咕咕</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">6e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> trie[N * <span class="number">24</span>][<span class="number">2</span>], lst[N * <span class="number">24</span>];</span><br><span class="line"><span class="keyword">int</span> s[N], rt[N], n, m, tot;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> k, <span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        lst[q] = i;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> c = s[i] &gt;&gt; k &amp; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (p)</span><br><span class="line">        trie[q][c ^ <span class="number">1</span>] = trie[p][c ^ <span class="number">1</span>];</span><br><span class="line">    trie[q][c] = ++tot;</span><br><span class="line">    <span class="built_in">insert</span>(i, k - <span class="number">1</span>, trie[p][c], trie[q][c]);</span><br><span class="line">    lst[q] = <span class="built_in">max</span>(lst[trie[q][<span class="number">0</span>]], lst[trie[q][<span class="number">1</span>]]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> now, <span class="keyword">int</span> val, <span class="keyword">int</span> k, <span class="keyword">int</span> lim)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> s[lst[now]] ^ val;</span><br><span class="line">    <span class="keyword">int</span> c = val &gt;&gt; k &amp; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (lst[trie[now][c ^ <span class="number">1</span>]] &gt;= lim)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">ask</span>(trie[now][c ^ <span class="number">1</span>], val, k - <span class="number">1</span>, lim);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">ask</span>(trie[now][c], val, k - <span class="number">1</span>, lim);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    lst[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">    rt[<span class="number">0</span>] = ++tot;</span><br><span class="line">    <span class="built_in">insert</span>(<span class="number">0</span>, <span class="number">23</span>, <span class="number">0</span>, rt[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, x; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">        s[i] = s[i - <span class="number">1</span>] ^ x;</span><br><span class="line">        rt[i] = ++tot;</span><br><span class="line">        <span class="built_in">insert</span>(i, <span class="number">23</span>, rt[i - <span class="number">1</span>], rt[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="keyword">char</span> opt[<span class="number">2</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, opt);</span><br><span class="line">        <span class="keyword">if</span> (opt[<span class="number">0</span>] == <span class="string">&#x27;A&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> x;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">            rt[++n] = ++tot;</span><br><span class="line">            s[n] = s[n - <span class="number">1</span>] ^ x;</span><br><span class="line">            <span class="built_in">insert</span>(n, <span class="number">23</span>, rt[n - <span class="number">1</span>], rt[n]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> l, r, x;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;l, &amp;r, &amp;x);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">ask</span>(rt[r - <span class="number">1</span>], x ^ s[n], <span class="number">23</span>, l - <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="BZOJ-2741-【FOTILE模拟赛】L"><a href="#BZOJ-2741-【FOTILE模拟赛】L" class="headerlink" title="BZOJ 2741 【FOTILE模拟赛】L"></a><a target="_blank" rel="noopener" href="https://www.lydsy.com/JudgeOnline/problem.php?id=2741">BZOJ 2741 【FOTILE模拟赛】L</a></h2><p>分块+可持久化 01 Trie</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">12500</span>;</span><br><span class="line"><span class="keyword">int</span> len, blo[N], f[<span class="number">120</span>][N];</span><br><span class="line"><span class="keyword">int</span> rt[N*<span class="number">32</span>], ch[N*<span class="number">32</span>][<span class="number">2</span>], lst[N*<span class="number">32</span>], cnt;</span><br><span class="line"><span class="keyword">int</span> n, m, a[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">(<span class="keyword">int</span> now, <span class="keyword">int</span> pre, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> u = rt[now] = ++cnt, v = rt[pre];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">30</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = val &gt;&gt; i &amp; <span class="number">1</span>;</span><br><span class="line">        ch[u][x ^ <span class="number">1</span>] = ch[v][x ^ <span class="number">1</span>];</span><br><span class="line">        u = ch[u][x] = ++cnt, v = ch[v][x];</span><br><span class="line">        lst[cnt] = now + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> u = rt[r], res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">30</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = val &gt;&gt; i &amp; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (lst[ch[u][x ^ <span class="number">1</span>]] &gt;= l + <span class="number">1</span>)</span><br><span class="line">            res |= <span class="number">1</span> &lt;&lt; i, u = ch[u][x ^ <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            u = ch[u][x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    len = <span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="built_in">ins</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    blo[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    	blo[i] = (i<span class="number">-1</span>) / len + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, a + i);</span><br><span class="line">        a[i] ^= a[i - <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">ins</span>(i, i - <span class="number">1</span>, a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = len; i &lt;= n; i += len) &#123;</span><br><span class="line">        <span class="keyword">int</span> k = i / len;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">            f[k][j] = <span class="built_in">max</span>(f[k][j - <span class="number">1</span>], <span class="built_in">ask</span>(i, j - <span class="number">1</span>, a[j]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> l, r, l2, ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">        l = (l + ans) % n + <span class="number">1</span>, r = (r + ans) % n + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (l &gt; r)</span><br><span class="line">            <span class="built_in">swap</span>(l, r);</span><br><span class="line">        l--, ans = <span class="number">0</span>;</span><br><span class="line">        l2 = <span class="built_in">min</span>(blo[l] * len, r);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = l; i &lt;= l2; i++)</span><br><span class="line">            ans = <span class="built_in">max</span>(ans, <span class="built_in">ask</span>(l, r, a[i]));</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, f[blo[l]][r]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.ylif4.cf/four-russian-%E7%AE%97%E6%B3%95">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LewisLi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YLiF4">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/four-russian-%E7%AE%97%E6%B3%95" class="post-title-link" itemprop="url">Four Russian 算法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-26 21:51:54 / 修改时间：21:56:08" itemprop="dateCreated datePublished" datetime="2021-07-26T21:51:54+08:00">2021-07-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="普通做法"><a href="#普通做法" class="headerlink" title="普通做法"></a>普通做法</h1><p>分块，设块长为 $len$。我们求出每个块内的ST表，再求出块之间的ST表。</p>
<p>当$len=\log n$时预处理复杂度最优，为$O(\dfrac{n}{\log n} \log n+\dfrac{n}{\log n} \log n\log\log n)=O(n\log\log n)$。</p>
<p>查询就可以直接分成左-中-右三段进行查询。</p>
<h1 id="算法改进"><a href="#算法改进" class="headerlink" title="算法改进"></a>算法改进</h1><p>左右两端本质上是对前后缀的操作。可以在预处理的时候 $O(n)$ 求出块内前后缀最大值。</p>
<p>这样查询的时候就只要访问一个 ST 表。</p>
<h1 id="玄学优化"><a href="#玄学优化" class="headerlink" title="玄学优化"></a>玄学优化</h1><p>分块乱搞，设块大小为 $len$。</p>
<p>我们暴力预处理每个块前缀、后缀的最大值，用 ST表 求出任意连续块之间的最大值。</p>
<p>预处理复杂度为 $O(\dfrac{n}{len}\log\dfrac{n}{len}+n+n) = O(n)$。</p>
<p>查询的时候找中间夹着的块的最大值、左侧后缀和右侧前缀。</p>
<p>查询显然是 $O(1)$ 的。</p>
<p>但是这个做法有问题。当左右端点在同一块内时就假了。</p>
<p>两个端点在同一块内的概率是 $\dfrac{len}{n}$，每次查询的代价是 $len$，所以期望为 $O(\dfrac{len^2}{n})$。</p>
<p>令 $len = \sqrt n$  每次暴力查询期望复杂度为 $O(1)$。</p>
<p>这样我们就得到了一个 $O(n)$ 预处理， $O(1)$ 查询的做法。时间复杂度期望 $O(n)$。</p>
<p>但是出题人不会卡你吗？</p>
<p>可能会，但一般卡不掉，而且不敢卡。</p>
<p>因为我们可以对块的大小进行调整，而出题人不知道你的块长。而只要让两端尽量在不同块内就可以保证复杂度。</p>
<p>如果出题人刻意卡这种做法，就要让 $l,r$ 尽量接近。但这样暴力就很可能直接硬跑过去。</p>
<p>这个算法的复杂度接近下界，并且无论是复杂度还是常数、代码难度都较小，所以较实用。</p>
<h1 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h1><h2 id="Luogu-P3865-【模板】ST表"><a href="#Luogu-P3865-【模板】ST表" class="headerlink" title="Luogu P3865 【模板】ST表"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3865">Luogu P3865 【模板】ST表</a></h2><p>ST 表板题，可以作为板子打。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> a[N], st[N/<span class="number">10</span>][<span class="number">25</span>];</span><br><span class="line"><span class="keyword">int</span> pre[N], suf[N];</span><br><span class="line"><span class="keyword">int</span> block, n, m;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> n = <span class="number">0</span>, f = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">for</span> (; ch &lt; <span class="string">&#x27;0&#x27;</span> || ch &gt; <span class="string">&#x27;9&#x27;</span>; ch = <span class="built_in">getchar</span>()) <span class="keyword">if</span> (ch == <span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; ch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; ch &lt;= <span class="string">&#x27;9&#x27;</span>; ch = <span class="built_in">getchar</span>()) n = (n &lt;&lt; <span class="number">3</span>) + (n &lt;&lt; <span class="number">1</span>) + (ch ^ <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> n * f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getpos</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> (x + block - <span class="number">1</span>) / block; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bf</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = a[l];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = l; i &lt;= r; i++)</span><br><span class="line">        res = <span class="built_in">max</span>(res, a[i]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = <span class="built_in">getpos</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> len = <span class="number">1</span>; len &lt;= <span class="number">20</span>; len++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= p - (<span class="number">1</span> &lt;&lt; len) + <span class="number">1</span>; i++)</span><br><span class="line">            st[i][len] = <span class="built_in">max</span>(st[i][len - <span class="number">1</span>], st[i + (<span class="number">1</span> &lt;&lt; (len - <span class="number">1</span>))][len - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">if</span> (i % block != <span class="number">1</span>)</span><br><span class="line">            pre[i] = <span class="built_in">max</span>(pre[i - <span class="number">1</span>], a[i]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pre[i] = a[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; i--)</span><br><span class="line">        <span class="keyword">if</span> (i % block)</span><br><span class="line">            suf[i] = <span class="built_in">max</span>(suf[i + <span class="number">1</span>], a[i]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            suf[i] = a[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> e = <span class="built_in">log2</span>(r - l - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> res = <span class="built_in">max</span>(st[l + <span class="number">1</span>][e], st[r - (<span class="number">1</span> &lt;&lt; e)][e]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    n = <span class="built_in">read</span>(), m = <span class="built_in">read</span>();</span><br><span class="line">    block = <span class="built_in">log2</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="built_in">getpos</span>(i);</span><br><span class="line">        a[i] = <span class="built_in">read</span>();</span><br><span class="line">        st[j][<span class="number">0</span>] = <span class="built_in">max</span>(a[i], st[j][<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x, y; m; m--) &#123;</span><br><span class="line">        x = <span class="built_in">read</span>(), y = <span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">int</span> l = <span class="built_in">getpos</span>(x), r = <span class="built_in">getpos</span>(y);</span><br><span class="line">        <span class="keyword">if</span> (l == r) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">bf</span>(x, y));</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (r - l == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">max</span>(pre[y], suf[x]));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">max</span>(<span class="built_in">max</span>(pre[y],suf[x]),<span class="built_in">query</span>(l,r)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Luogu-P3793-由乃救爷爷"><a href="#Luogu-P3793-由乃救爷爷" class="headerlink" title="Luogu P3793 由乃救爷爷"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3793">Luogu P3793 由乃救爷爷</a></h2><p>详见 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/Lewis-Li/p/LG_P3793.html">Luogu P3793 由乃救爷爷</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.ylif4.cf/fft-%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LewisLi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YLiF4">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/fft-%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F" class="post-title-link" itemprop="url">FFT 从入门到入土</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-26 21:51:54 / 修改时间：21:58:20" itemprop="dateCreated datePublished" datetime="2021-07-26T21:51:54+08:00">2021-07-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>FFT 是一种可以在 $O(n \log n)$ 的时间复杂度内求解两个多项式的乘积。实际上， FFT 只是在求解方法上优化了 DFT（离散傅里叶变换）的过程，并没有提出新的理论。但是其高效的复杂度使得它被广泛使用。</p>
<p>阅读此文章前请先对复数有基本的了解。</p>
<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><h2 id="系数表示法"><a href="#系数表示法" class="headerlink" title="系数表示法"></a>系数表示法</h2><p>就是使用一个多项式的系数序列来表达这个多项式。<br>$$<br>f(x) = \sum_{i=0}^{n-1} a_ix^i \Leftrightarrow f(x) = {a_0, a_1, \dots , a_{n-1}}<br>$$</p>
<h2 id="点值表示法"><a href="#点值表示法" class="headerlink" title="点值表示法"></a>点值表示法</h2><p>一个 $n$ 次多项式可以由 $n+1$ 个点来确定。</p>
<p>设 $y_i = f(x_i)$ 则<br>$$<br>f(x) = \sum_{i=0}^{n-1} a_ix^i \Leftrightarrow f(x) = {(x_0,y_0),(x_1,y_1),\dots,(x_n,y_n)}<br>$$</p>
<h2 id="多项式卷积"><a href="#多项式卷积" class="headerlink" title="多项式卷积"></a>多项式卷积</h2><p>定义多项式 $A(x) = \sum_{i=0} ^{n-1} a_ix^i$，$B(x)=\sum_{i=0}^{m}b_ix^i$，它们的乘积为<br>$$<br>(A * B)(x) = \sum_{i=0}^{n+m-2} x^i \sum_{k=0}^ia_kb_{i-k}<br>$$<br>实际上就是简单的直接相乘    </p>
<h1 id="单位复根"><a href="#单位复根" class="headerlink" title="单位复根"></a>单位复根</h1><h2 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h2><p>$n$ 次单位为满足 $\omega^n = 1$ 的解 $\omega$，记作 $\omega_n$。</p>
<p>显然，这 $n$ 个单位根均匀分布在复平面的单位圆上。</p>
<p><img src="https://sc04.alicdn.com/kf/Ud34a6b11f9924053be51b98e1d57675cP.jpg" alt="单位复根"></p>
<p>自然地，$w_n^k$ 的辐角为 $\dfrac{2k\pi}{n}$。因此，由欧拉公式，有<br>$$<br>\omega_n^k = \cos\dfrac{2k\pi}{n} + i\cdot\sin \dfrac{2\pi}{n}<br>$$</p>
<h2 id="单位根的性质"><a href="#单位根的性质" class="headerlink" title="单位根的性质"></a>单位根的性质</h2><ol>
<li><p>$\omega_n^k = \omega_{pn}^{pk}$</p>
<p>等分成 $pn$ 块相当于先分成 $n$ 块后再将每个块分成 $p$ 块，边界自然不变，</p>
</li>
<li><p>$\omega_n^{k+\frac{n}{2}} = -\omega_n^k$。</p>
<p>指数加 $\frac{n}{2}$ 相当于绕原点旋转 $\pi$ 。</p>
</li>
<li><p>$\omega_n^p \cdot \omega_n^q = \omega_n^{p+q}$</p>
<p>设 $\alpha = \frac{2p\pi}{n}, \beta = \frac{2q\pi}{n}$，则<br>$$<br>\begin{aligned}<br>\omega_{n}^{p} \times \omega_{n}^{q}&amp;=(\cos \alpha \cos \beta-\sin \alpha \sin \beta)+i(\sin \alpha \cos \beta+\cos \alpha \sin \beta)\ &amp;=\cos (\alpha+\beta)+i \sin<br>(\alpha+\beta)\&amp;=\omega_{n}^{p+q}<br>\end{aligned}<br>$$</p>
</li>
</ol>
<h1 id="离散傅里叶变换"><a href="#离散傅里叶变换" class="headerlink" title="离散傅里叶变换"></a>离散傅里叶变换</h1><p>我们发现，当两个多项式 $A,B$ 同时取 $x$ 时，得到的点分别为 $y_A,y_B$，$A*B$ 取到的点即为 $(x,y_A \cdot y_B)$。</p>
<p>这样做是 $O(n)$ 的。 </p>
<p>对于任意系数多项式转点值，我们可以随意取 $x$ 的值。<br>但如果我们代入 $\omega$，就可以免去很多次方计算。</p>
<p>但即使是这样，我们代入还是 $O(n^2)$ 的复杂度。</p>
<h1 id="快速傅里叶变换"><a href="#快速傅里叶变换" class="headerlink" title="快速傅里叶变换"></a>快速傅里叶变换</h1><p>FFT 算法的基本思想是分治。我们要分治地求：当 $f(x)=\omega_n^k$ 时 $f(x)$ 的值。</p>
<p>我们将系数分为奇数项和偶数项来进行处理。<br>$$<br>g(x) = a_0 + a_2x + … + a_{n - 2}x^{\frac{n}{2} - 1} \<br>h(x) = a_1 + a_3x + … + a_{n - 1}x^{\frac{n}{2} - 1}<br>$$<br>原来的 $f$ 就表示为<br>$$<br>f(x)=g(x^2)+x\cdot h(x^2)<br>$$</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.ylif4.cf/%E6%9D%9C%E6%95%99%E7%AD%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LewisLi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YLiF4">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%9D%9C%E6%95%99%E7%AD%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0" class="post-title-link" itemprop="url">杜教筛学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-26 21:51:54 / 修改时间：21:58:34" itemprop="dateCreated datePublished" datetime="2021-07-26T21:51:54+08:00">2021-07-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>杜教筛可以用来在非线性时间内求一个积性函数的前缀和，即$S(n) = \sum_{i=1}^{n} f(i)$</p>
<h1 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h1><h2 id="积性函数"><a href="#积性函数" class="headerlink" title="积性函数"></a>积性函数</h2><p>积性函数：若有数论函数$f$对于任意互质整数$a, b$都有$f(a \cdot b) = f(a) \cdot f(b)$，则$f$为积性函数。</p>
<p>完全积性函数：对于任意整数$a,b$有 $f(a \cdot b)=f(a) \cdot f(b)$的数论函数。</p>
<p>这里列举一些常见的：</p>
<ul>
<li><p>积性函数：$\varphi,\mu,\sigma,d$</p>
</li>
<li><p>完全积性函数：$\epsilon,I,id$</p>
</li>
</ul>
<h2 id="狄利克雷卷积"><a href="#狄利克雷卷积" class="headerlink" title="狄利克雷卷积"></a>狄利克雷卷积</h2><p>设 $f, g$ 是两个数论函数，它们的狄利克雷卷积是：<br>$$<br>(f \cdot g)(n) = \sum \limits _{d | n} f(d) \cdot g(\frac{n}{d})<br>$$</p>
<p>它满足交换律、结合律、分配律</p>
<p>单位元是$\epsilon$，即$f \cdot \epsilon = f$</p>
<p>这里有几个常用的等式：</p>
<p>$$\mu \cdot I = \epsilon \ \varphi \cdot I = id \ \mu \cdot id = \varphi$$</p>
<h2 id="整除分块"><a href="#整除分块" class="headerlink" title="整除分块"></a>整除分块</h2><p>很多反演题目都会有一个这样的形式：$\large \sum_{i=1}^n \left\lfloor \frac{n}{i} \right\rfloor$</p>
<p>对于这个式子，我们可以朴素地进行$O(N)$的计算。但是很多情况下，这种做法的复杂度是不被允许的。</p>
<p>我们对于每一个$n$进行打表，发现有大量的值是重复的，而每一个值按顺序排布，呈块状形式，并且每一块的末尾为$\left\lfloor \dfrac{n}{\left\lfloor \frac{n}{i} \right\rfloor} \right\rfloor$。至此，我们就可以在$O(\sqrt{N})$的时间内进行计算。</p>
<p>但是上式经常会乘上一些积性函数，这时就可以对积性函数求一个前缀和，每一次跳块也就相当于跳过了这一整段的函数和。</p>
<p>一般的整除分块形式：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> l=<span class="number">1</span>,r=<span class="number">0</span>; l&lt;=n; l=r+<span class="number">1</span>) &#123;</span><br><span class="line">	r=n / (n / l);</span><br><span class="line">	<span class="comment">// Your Code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="莫比乌斯反演"><a href="#莫比乌斯反演" class="headerlink" title="莫比乌斯反演"></a>莫比乌斯反演</h1><p>若有<br>$$<br>F(n) = \sum_{d \mid n}f(d)<br>$$<br>则<br>$$<br>f(n) =\sum_{d \mid n} \mu(d) \cdot F(\frac{n}{d}) = \sum_{d \mid n} \mu(\frac{n}{d}) \cdot F(d)<br>$$</p>
<h2 id="证明："><a href="#证明：" class="headerlink" title="证明："></a>证明：</h2><p>我们用狄利克雷卷积来表示上面的式子，得到$F = f \cdot I$</p>
<p>将$F$卷上$\mu$得到<br>$$<br>F \cdot \mu = f \cdot I \cdot \mu \<br>F \cdot \mu = f \cdot (I \cdot \mu) = f \cdot \epsilon = f \<br>f = F \cdot \mu<br>$$<br>代入狄利克雷卷积原式：<br>$$<br>f(n) =\sum_{d \mid n} \mu(d) \cdot F(\frac{n}{d}) = \sum_{d \mid n} \mu(\frac{n}{d}) \cdot F(d)<br>$$<br>证毕。</p>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="Luogu-P2398-GCD-SUM"><a href="#Luogu-P2398-GCD-SUM" class="headerlink" title="Luogu P2398 GCD SUM"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2398">Luogu P2398 GCD SUM</a></h3><p>给定$n$，求<br>$$<br>\sum_{i=1}^{n}\sum_{j=1}^{n} \gcd(i,j)<br>$$</p>
<h3 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h3><p>欧拉函数有一个性质：$\large \sum_{d \mid n} \varphi(d) = n$</p>
<p>于是我们可以将原式子套路一下：<br>$$<br>\sum_{i=1}^{n}\sum_{j=1}^{n} \gcd(i,j) \<br>= \sum_{i=1}^{n}\sum_{j=1}^{n} \sum_{d \mid \gcd(i,j)} \varphi(d) \<br>= \sum_{i=1}^{n}\sum_{j=1}^{n} \sum_{d \mid i, d \mid j} \varphi(d)<br>$$<br>把$d$提到前面去：<br>$$<br>=\sum_{d=1}^{n} \sum_{i=1}^{\left\lfloor\frac{n}{d}\right\rfloor} \sum_{j=1}^{\left\lfloor\frac{n}{d}\right\rfloor}\varphi(d) \<br>= \sum_{d=1}^{n} \varphi(d) \cdot \left\lfloor\frac{n}{d}\right\rfloor \cdot \left\lfloor\frac{n}{d}\right\rfloor<br>$$</p>
<p>这样就可以做了。可以用欧拉筛筛出欧拉函数的前缀和，使用整除分块进行优化。</p>
<h3 id="Luogu-P2257-YY的GCD"><a href="#Luogu-P2257-YY的GCD" class="headerlink" title="Luogu P2257 YY的GCD"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2257">Luogu P2257 YY的GCD</a></h3><p>给定$n,m$，求<br>$$<br>\sum_{i=1}^n\sum_{j=1}^m [\gcd(i,j)\in Prime]<br>$$</p>
<h3 id="做法-1"><a href="#做法-1" class="headerlink" title="做法"></a>做法</h3><p>我们不知道$\gcd(i,j)$是多少，所以我们枚举它（这里假定$n \leqslant m$）：<br>$$<br>\sum_{p \in Prime}^n \sum_{i=1}^n\sum_{j=1}^m [\gcd(i,j)=p]<br>$$<br>同时除以$k$得到<br>$$<br>\sum_{p \in Prime}^n \sum_{i=1}^{\left\lfloor\frac{n}{p}\right\rfloor} \sum_{j=1}^{\left\lfloor\frac{m}{p}\right\rfloor} [\gcd(i,j)=1]<br>$$<br>利用一下$\mu$的性质：$\large \sum_{d \mid n} \mu(d) = [n = 1]$</p>
<p>像上一题那样，把后面替换掉：<br>$$<br>\sum_{p \in Prime}^n \sum_{i=1}^{\left\lfloor\frac{n}{p}\right\rfloor} \sum_{j=1}^{\left\lfloor\frac{m}{p}\right\rfloor} \sum_{d \mid \gcd(i,j)} \mu(d)<br>$$<br>枚举$d$，把$d$提到前面。因为$d \mid \gcd(i,j)$，所以$i,j$是$d$的倍数，把它们上限全都除上$d$，后面再乘回去，发现个数可直接求，所以去掉两个求和：<br>$$<br>\sum_{p \in Prime}^n \sum_{d=1}^{\left\lfloor\frac{n}{p}\right\rfloor} \mu(d) \cdot \left\lfloor\frac{n}{pd}\right\rfloor \cdot \left\lfloor\frac{m}{pd}\right\rfloor<br>$$<br>但是这样的复杂度还是过不去。我们继续优化：设$T = p \cdot d$，枚举$T$，再次提到前面去：<br>$$<br>\sum_{T=1}^{n} \sum_{p \mid T, p \in Prime} \left\lfloor \frac{n}{T} \right\rfloor \cdot \left\lfloor \frac{m}{T} \right\rfloor \cdot \mu(\frac{T}{p})<br>$$<br>而后面还是可以预处理+整除分块进行优化。</p>
<h1 id="杜教筛"><a href="#杜教筛" class="headerlink" title="杜教筛"></a>杜教筛</h1><h2 id="一般式"><a href="#一般式" class="headerlink" title="一般式"></a>一般式</h2><p>我们要求$\large \sum_{i=1}^{n} f(i)$</p>
<p>用狄利克雷卷积，设有积性函数$F,g$满足$F = f \cdot g$，记$S(n)$为上式。如果说我们的$F,g$都是很容易求的函数，那么我们就可以用它们来求$f$。那么，我们推一下$F$的前缀和：<br>$$<br>\sum_{i=1}^{n}F(i) = \sum_{i=1}^{n}\sum_{d | n} g(d) \cdot f(\frac{n}{d}) \<br>= \sum_{d=1}^{n}g(d) \cdot \sum_{i=1}^{\left\lfloor \frac{n}{d} \right\rfloor} f(i) \<br>= \sum_{d=1}^{n}g(d) \cdot S(\frac{n}{d})<br>$$<br>我们要求的是$S(n)$，所以我们从右式中拆一个出来，即把$i=1$单独考虑：<br>$$<br>\sum_{i=1}^{n}F(i) = g(1) \cdot S(n) + \sum_{d=2}^{n}g(d) \cdot S(\frac{n}{d}) \<br>g(1) \cdot S(n) = \sum_{i=1}^{n}F(i) - \sum_{d=2}^{n}g(d) \cdot S(\frac{n}{d})<br>$$<br>这就是杜教筛的一般式。现在我们来举几个例子：</p>
<h2 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h2><h3 id="Luogu-P4213-【模板】杜教筛（Sum）"><a href="#Luogu-P4213-【模板】杜教筛（Sum）" class="headerlink" title="Luogu P4213 【模板】杜教筛（Sum）"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4213">Luogu P4213 【模板】杜教筛（Sum）</a></h3><p>给定正整数$n$，求：<br>$$<br>ans1 = \sum_{i=1}^{n} \varphi(i) \<br>ans2 = \sum_{i=1}^{n} \mu(i)<br>$$</p>
<h3 id="做法-2"><a href="#做法-2" class="headerlink" title="做法"></a>做法</h3><p>由$\mu \cdot I = \epsilon$，很自然想到$F = \epsilon, g = I$，代入原式子即得<br>$$<br>S(n) = 1 - \sum_{d=2}^{n}S(\frac{n}{d})<br>$$<br>同时，因为$\varphi \cdot I = id$，代入一般式得<br>$$<br>S(n) = \frac{n \cdot (n+1)}{2} - \sum_{d=2}^{n}S(\frac{n}{d})<br>$$</p>
<p>类似地，我们使用整除分块+记忆化搜索解决。但是出杜教筛的题$n$一般较大，可以手写个 hash 或者直接使用<code>unordered_map</code>解决。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.ylif4.cf/%E6%95%B4%E9%99%A4%E6%80%A7%E4%B8%8E%E7%AE%97%E6%95%B0%E5%9F%BA%E6%9C%AC%E5%AE%9A%E7%90%86">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LewisLi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YLiF4">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%95%B4%E9%99%A4%E6%80%A7%E4%B8%8E%E7%AE%97%E6%95%B0%E5%9F%BA%E6%9C%AC%E5%AE%9A%E7%90%86" class="post-title-link" itemprop="url">整除性与算数基本定理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-26 21:51:54 / 修改时间：21:58:59" itemprop="dateCreated datePublished" datetime="2021-07-26T21:51:54+08:00">2021-07-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>若一个大于1的正整数只能被1和它本身整除，则称该数为质数（或素数），否则称该数为合数（复合数）。</p>
<p>如果一个正整数$a$有一个因数$b$，并且$b$为质数，则称$b$为$a$的质因数。</p>
<p>若有正整数$a_1, a_2,\cdot \cdot \cdot ,a_n(n \geqslant 2)$和$d$，并且$d|a_1,d|a_2,\cdot \cdot \cdot ,d|a_n$，则称$d$为$a_1,\cdot \cdot \cdot ,a_n$的公因数。其中最大的那一个数叫做$a_1,\cdot \cdot \cdot ,a_n$的最大公因数，写作$\gcd(a_1,\cdot \cdot \cdot ,a_n)$。</p>
<p>若有正整数$a_1, a_2,\cdot \cdot \cdot ,a_n(n \geqslant 2)$和$m$，并且$a_1|m,a_2|m,\cdot \cdot \cdot ,a_n|m$，则称$m$为$a_1,\cdot \cdot \cdot ,a_n$的公倍数。其中最小的那一个数叫做$a_1,\cdot \cdot \cdot ,a_n$的最小公倍数，写作$\operatorname{lcm}(a_1,\cdot \cdot \cdot ,a_n)$。</p>
<p>在整个自然数集合中，质数数量不多，分布稀疏。对于一个足够大的数$N$，不超过$N$的质数大约有$\frac{n}{\ln N}$个，即每$\ln N$个数中大约有一个质数。</p>
<h1 id="引理"><a href="#引理" class="headerlink" title="引理"></a>引理</h1><ol>
<li><p>一个大于1的正整数$a$的大于1的最小因数一定是质数。</p>
<p>如果$a$是质数，则引理显然成立。</p>
<p>如果$a$是合数，则除去1和$a$以外，一定还有其它正因数，设那个最小的为$b$。</p>
<p>若$b$是合数，则$b$必然有一个大于1小于$b$的因数$c$，由$c|b,b|a$得到$c|a$且$c&lt;a$，矛盾。引理得证。</p>
<p>这个引理说明了任何一个大于1的正整数都至少有一个质因数。</p>
</li>
<li><p>有无限多个质数。</p>
<p>假设质数有有限多个，个数为$n$，分别为$p_1,p_2,\cdot \cdot \cdot ,p_n$。令$a=p_1p_2 \cdot \cdot \cdot p_n+1$。如果$a$是素数，因为$a \ne p_1,p_2,\cdot\cdot\cdot,p_n$，所以质数最少应有$n+1$个，矛盾。如果$a$是合数，由引理1得$a$一定有一个质因数$b$且$b \ne p_1,p_2,\cdot\cdot\cdot,p_n$，矛盾。</p>
</li>
<li><p>若一正整数$a$为合数，则存在一个能整除$a$的数$d$，其中$2\leqslant d \leqslant \sqrt a$</p>
<p>由定义，因为$a$为合数，所以存在一个能整除$a$的数$m$，其中$2\leqslant m \leqslant n-1$。</p>
</li>
<li><p>任何大于1的整数$a$都能分解成质因数的连乘积，即$a = \prod_{i=1}^{n}p_i \ (n \geqslant 1)$</p>
<p>当$a$为质数时，$a=p$，引理成立。</p>
<p>当$a$为合数时，由引理1，$a$必然有一个质因数$p_1$，使得$a=p_1 \cdot a_1 (a_1 &gt; 1)$。如果$a_1$为质数，引理成立。否则，重复上述过程，最后必得$a = \prod_{i=1}^{n}p_i \ (n \geqslant 1)$。</p>
</li>
</ol>
<h1 id="质数"><a href="#质数" class="headerlink" title="质数"></a>质数</h1><h2 id="质数的判定"><a href="#质数的判定" class="headerlink" title="质数的判定"></a>质数的判定</h2><h3 id="试除法"><a href="#试除法" class="headerlink" title="试除法"></a>试除法</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.ylif4.cf/%E7%8B%84%E5%88%A9%E5%85%8B%E9%9B%B7%E5%8D%B7%E7%A7%AF">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LewisLi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YLiF4">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%8B%84%E5%88%A9%E5%85%8B%E9%9B%B7%E5%8D%B7%E7%A7%AF" class="post-title-link" itemprop="url">狄利克雷卷积</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-26 21:51:54 / 修改时间：21:56:57" itemprop="dateCreated datePublished" datetime="2021-07-26T21:51:54+08:00">2021-07-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>狄利克雷卷积是一些算法的基础。很多时候使用狄利克雷卷积来推式子会比暴力推方便很多。</p>
<p><strong>狄利克雷卷积</strong>其实就是定义在<strong>数论函数</strong>之间的一种二元运算：<br>$$<br>(f \cdot g)(n)=\sum_{d|n} f(d)\cdot g(\dfrac{n}{d})<br>$$<br>我们首先定义一些常用的数论函数：</p>
<ul>
<li><p>单位函数（单位元）$\epsilon(n)= \begin{cases}1&amp;n=1 \ 0&amp;n \neq 1 \end{cases}$</p>
</li>
<li><p>幂函数$\operatorname{Id}_k(n) = n^k$，当$k=0$时为常数函数$\operatorname{I}(n)=1$</p>
</li>
<li><p>除数函数$\sigma_k(n)=\sum_{d|n}d^k$，当$k=0$时为约数个数函数$\operatorname{d}(n)$，$k=1$时为约数和函数$\sigma(n)$。</p>
</li>
<li><p>欧拉函数$\varphi(n)=\sum_{gcd(i,n)=1,, i \leqslant n} 1$</p>
</li>
<li><p>莫比乌斯函数$\mu(n)=\begin{cases} 1&amp;n=1 \ {-1}^m&amp;n=p_1p_2 \cdot\cdot\cdot p_m \ 0&amp; \rm{otherwise} \end{cases}$</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.ylif4.cf/hello-world">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LewisLi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YLiF4">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/hello-world" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-26 20:49:24" itemprop="dateCreated datePublished" datetime="2021-07-26T20:49:24+08:00">2021-07-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LewisLi</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
